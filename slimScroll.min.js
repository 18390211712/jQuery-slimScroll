/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.6.5
 * 
 */(function(e){jQuery.fn.extend({slimScroll:function(t){var n={wheelStep:20,width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:"0.2",railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,scroll:0,touchScrollStep:200},r=e.extend(n,t);return this.each(function(){function x(e,t,n){var i=e;if(t){i=parseInt(w.css("top"))+e*parseInt(r.wheelStep)/100*w.outerHeight();var s=d.outerHeight()-w.outerHeight();i=Math.min(Math.max(i,0),s),w.css({top:i+"px"})}f=parseInt(w.css("top"))/(d.outerHeight()-w.outerHeight()),i=f*(d[0].scrollHeight-d.outerHeight());if(n){i=e;var u=i/d[0].scrollHeight*d.outerHeight();w.css({top:u+"px"})}d.scrollTop(i),C(),k()}function N(){a=Math.max(d.outerHeight()/d[0].scrollHeight*d.outerHeight(),h),w.css({height:a+"px"})}function C(){N(),clearTimeout(s);if(f==~~f){p=r.allowPageScroll;if(l!=f){var e=~~f==0?"top":"bottom";d.trigger("slimscroll",e)}}l=f;if(a>=d.outerHeight()){p=!0;return}w.stop(!0,!0).fadeIn("fast"),r.railVisible&&b.stop(!0,!0).fadeIn("fast")}function k(){r.alwaysVisible||(s=setTimeout(function(){(!r.disableFadeOut||!t)&&!n&&!i&&(w.fadeOut("slow"),b.fadeOut("slow"))},1e3))}var t,n,i,s,u,a,f,l,c="<div></div>",h=30,p=!1,d=e(this);if(d.parent().hasClass("slimScrollDiv")){if(r.scroll){w=d.parent().find(".slimScrollBar"),b=d.parent().find(".slimScrollRail");var v=0,m=r.scroll;if(typeof m=="string")if(m.charAt(1)=="="){v=d.scrollTop();var g=m.charAt(0);m=parseInt(m.substr(2)),g=="-"&&(m*=-1),v+=m}else v=parseInt(m);else v=m}x(v,!1,!0);return}var y=e(c).addClass(r.wrapperClass).css({position:"relative",overflow:"hidden",width:r.width,height:r.height});d.css({overflow:"hidden",width:r.width,height:r.height});var b=e(c).addClass(r.railClass).css({width:r.size,height:"100%",position:"absolute",top:0,display:r.alwaysVisible&&r.railVisible?"block":"none","border-radius":r.size,background:r.railColor,opacity:r.railOpacity,zIndex:90}),w=e(c).addClass(r.barClass).css({background:r.color,width:r.size,position:"absolute",top:0,opacity:r.opacity,display:r.alwaysVisible?"block":"none","border-radius":r.size,BorderRadius:r.size,MozBorderRadius:r.size,WebkitBorderRadius:r.size,zIndex:99}),E=r.position=="right"?{right:r.distance}:{left:r.distance};b.css(E),w.css(E),d.wrap(y),d.parent().append(w),d.parent().append(b),w.draggable({axis:"y",containment:"parent",start:function(){i=!0},stop:function(){i=!1,k()},drag:function(t){x(0,e(this).position().top,!1)}}),b.hover(function(){C()},function(){k()}),w.hover(function(){n=!0},function(){n=!1}),d.hover(function(){t=!0,C(),k()},function(){t=!1,k()}),d.bind("touchstart",function(e,t){e.originalEvent.touches.length&&(u=e.originalEvent.touches[0].pageY)}),d.bind("touchmove",function(e){e.originalEvent.preventDefault();if(e.originalEvent.touches.length){var t=(u-e.originalEvent.touches[0].pageY)/r.touchScrollStep;x(t,!0)}});var S=function(e){if(!t)return;var e=e||window.event,n=0;e.wheelDelta&&(n=-e.wheelDelta/120),e.detail&&(n=e.detail/3),x(n,!0),e.preventDefault&&!p&&e.preventDefault(),p||(e.returnValue=!1)},T=function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",S,!1),this.addEventListener("mousewheel",S,!1)):document.attachEvent("onmousewheel",S)};T(),N(),r.start=="bottom"?(w.css({top:d.outerHeight()-w.outerHeight()}),x(0,!0)):typeof r.start=="object"&&(x(e(r.start).position().top,null,!0),r.alwaysVisible||w.hide())}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);