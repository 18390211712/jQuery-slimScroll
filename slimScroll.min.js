/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.6.5
 * 
 */(function(e){jQuery.fn.extend({slimScroll:function(t){var n={wheelStep:20,width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:"0.2",railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,scroll:0,touchScrollStep:200},r=e.extend(n,t);return this.each(function(){function w(e,t,n){var i=e;if(t){i=parseInt(g.css("top"))+e*parseInt(r.wheelStep)/100*g.outerHeight();var s=d.outerHeight()-g.outerHeight();i=Math.min(Math.max(i,0),s),g.css({top:i+"px"})}f=parseInt(g.css("top"))/(d.outerHeight()-g.outerHeight()),i=f*(d[0].scrollHeight-d.outerHeight());if(n){i=e;var u=i/d[0].scrollHeight*d.outerHeight();g.css({top:u+"px"})}d.scrollTop(i),x(),T()}function S(){a=Math.max(d.outerHeight()/d[0].scrollHeight*d.outerHeight(),h),g.css({height:a+"px"})}function x(){S(),clearTimeout(s);if(f==~~f){p=r.allowPageScroll;if(l!=f){var e=~~f==0?"top":"bottom";d.trigger("slimscroll",e)}}l=f;if(a>=d.outerHeight()){p=!0;return}g.stop(!0,!0).fadeIn("fast"),r.railVisible&&m.stop(!0,!0).fadeIn("fast")}function T(){r.alwaysVisible||(s=setTimeout(function(){(!r.disableFadeOut||!t)&&!n&&!i&&(g.fadeOut("slow"),m.fadeOut("slow"))},1e3))}var t,n,i,s,u,a,f,l,c="<div></div>",h=30,p=!1,d=e(this);if(d.parent().hasClass("slimScrollDiv")){r.scrollBy&&(g=d.parent().find(".slimScrollBar"),m=d.parent().find(".slimScrollRail"),w(d.scrollTop()+parseInt(r.scroll),!1,!0));return}var v=e(c).addClass(r.wrapperClass).css({position:"relative",overflow:"hidden",width:r.width,height:r.height});d.css({overflow:"hidden",width:r.width,height:r.height});var m=e(c).addClass(r.railClass).css({width:r.size,height:"100%",position:"absolute",top:0,display:r.alwaysVisible&&r.railVisible?"block":"none","border-radius":r.size,background:r.railColor,opacity:r.railOpacity,zIndex:90}),g=e(c).addClass(r.barClass).css({background:r.color,width:r.size,position:"absolute",top:0,opacity:r.opacity,display:r.alwaysVisible?"block":"none","border-radius":r.size,BorderRadius:r.size,MozBorderRadius:r.size,WebkitBorderRadius:r.size,zIndex:99}),y=r.position=="right"?{right:r.distance}:{left:r.distance};m.css(y),g.css(y),d.wrap(v),d.parent().append(g),d.parent().append(m),g.draggable({axis:"y",containment:"parent",start:function(){i=!0},stop:function(){i=!1,T()},drag:function(t){w(0,e(this).position().top,!1)}}),m.hover(function(){x()},function(){T()}),g.hover(function(){n=!0},function(){n=!1}),d.hover(function(){t=!0,x(),T()},function(){t=!1,T()}),d.bind("touchstart",function(e,t){e.originalEvent.touches.length&&(u=e.originalEvent.touches[0].pageY)}),d.bind("touchmove",function(e){e.originalEvent.preventDefault();if(e.originalEvent.touches.length){var t=(u-e.originalEvent.touches[0].pageY)/r.touchScrollStep;w(t,!0)}});var b=function(e){if(!t)return;var e=e||window.event,n=0;e.wheelDelta&&(n=-e.wheelDelta/120),e.detail&&(n=e.detail/3),w(n,!0),e.preventDefault&&!p&&e.preventDefault(),p||(e.returnValue=!1)},E=function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",b,!1),this.addEventListener("mousewheel",b,!1)):document.attachEvent("onmousewheel",b)};E(),S(),r.start=="bottom"?(g.css({top:d.outerHeight()-g.outerHeight()}),w(0,!0)):typeof r.start=="object"&&(w(e(r.start).position().top,null,!0),r.alwaysVisible||g.hide())}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);